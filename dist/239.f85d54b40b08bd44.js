"use strict";(self.webpackChunkmoveo_task_client=self.webpackChunkmoveo_task_client||[]).push([[239],{3239:(J,l,o)=>{o.r(l),o.d(l,{SessionModule:()=>G});var d=o(1791),h=o(9653),v=o(5153);const y=(0,h.ZF)("session");var a=o(5521),e=o(4650),T=o(5643),p=o(7153),g=o(6895),E=o(4968),M=o(8372),F=o(7866);const I=["codeEditor"];let C=(()=>{class n{constructor(t){this.renderer=t,this.isStudent=!1,this.code=null,this.codeChange=new e.vpe}ngAfterViewInit(){(0,E.R)(this.codeEditor?.nativeElement,"input").pipe((0,M.b)(500)).subscribe(t=>{this.onCodeChange(t)})}onCodeChange(t){this.codeChange.emit(t.target.innerText)}onTabPressedInEditor(t){t.preventDefault()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.Qsj))},n.\u0275cmp=e.Xpm({type:n,selectors:[["moveo-task-session"]],viewQuery:function(t,s){if(1&t&&e.Gf(I,5),2&t){let c;e.iGM(c=e.CRH())&&(s.codeEditor=c.first)}},inputs:{isStudent:"isStudent",code:"code"},outputs:{codeChange:"codeChange"},decls:4,vars:2,consts:[[1,"page-wrapper"],[1,"preformat-wrapper"],[1,"code-editor",3,"contentEditable","highlight","keydown.Tab"],["codeEditor",""]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"pre",1)(2,"div",2,3),e.NdJ("keydown.Tab",function(r){return s.onTabPressedInEditor(r)}),e.qZA()()()),2&t&&(e.xp6(2),e.Q6J("contentEditable",s.isStudent?"true":"false")("highlight",s.code))},dependencies:[F.y$],styles:[".page-wrapper[_ngcontent-%COMP%]{box-sizing:border-box}.page-wrapper[_ngcontent-%COMP%]   .preformat-wrapper[_ngcontent-%COMP%]{margin:0}.page-wrapper[_ngcontent-%COMP%]   .preformat-wrapper[_ngcontent-%COMP%]   .code-editor[_ngcontent-%COMP%]{padding:30px}"]}),n})();function x(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"moveo-task-session",1),e.NdJ("codeChange",function(c){e.CHM(t);const r=e.oxw();return e.KtG(r.onCodeChange(c))}),e.qZA(),e.BQk()}if(2&n){const t=i.ngIf,s=e.oxw();e.xp6(1),e.Q6J("isStudent",s.isStudent)("code",t.code)}}const B=[{path:"",component:(()=>{class n{constructor(t,s,c,r){this.store=t,this.authService=s,this.activatedRoute=c,this.sessionService=r,this.isStudent=!1,this.codeBlockId=null,this.uuid=null,this.codeChangeSubscription=null,this.sessionState$=this.store.pipe((0,h.Ys)(y))}ngOnInit(){this.isStudent=this.authService.authUser?.userType===v.F.STUDENT,this.codeBlockId=this.activatedRoute.snapshot.params.codeBlockId,this.uuid=this.activatedRoute.snapshot.params.uuid,this.codeBlockId&&this.store.dispatch((0,a.Cq)({payload:{codeBlockId:this.codeBlockId}})),this.uuid&&(this.sessionService.connectToSocket(this.uuid),this.isStudent||(this.codeChangeSubscription=this.sessionService.onReceiveCodeChange$.subscribe(t=>{this.store.dispatch((0,a.r$)({payload:{code:t}}))})))}ngOnDestroy(){this.sessionService.closeSocket(),this.codeChangeSubscription?.unsubscribe(),this.codeChangeSubscription=null}onCodeChange(t){this.sessionService.sendCodeChange(t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(h.yh),e.Y36(T.e),e.Y36(d.gz),e.Y36(p.m))},n.\u0275cmp=e.Xpm({type:n,selectors:[["moveo-task-login-container"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"isStudent","code","codeChange"]],template:function(t,s){1&t&&(e.YNc(0,x,2,2,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,s.sessionState$))},dependencies:[g.O5,C,g.Ov],encapsulation:2}),n})()}];let O=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.Bz.forChild(B),d.Bz]}),n})();var R=o(6907),S=o(5951),u=o(2260),Y=o(6129),P=o(4004),Q=o(262),$=o(9646);let A=(()=>{class n{constructor(t,s,c){this.actions$=t,this.router=s,this.sessionService=c,this.getCode$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(a.Cq),(0,Y.z)(r=>this.sessionService.getCode(r.payload.codeBlockId).pipe((0,P.U)(f=>(0,a.mS)({payload:{code:f.code}})),(0,Q.K)(f=>(0,$.of)((0,a.h7)()))))))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(u.eX),e.LFG(d.F0),e.LFG(p.m))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})(),G=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[O,R.m,h.Aw.forFeature(S.xB,S.cY),u.sQ.forFeature([A])]}),n})()}}]);